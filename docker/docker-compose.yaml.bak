name: paperclip_ai
services:
  paperclip_ai:
    build:
      context: .
      dockerfile: DockerfilePython
      args:
        USER_ID: 197609
        GROUP_ID: 197121
        USERNAME: eren
      secrets:
        - vnc_password
    image: eren_container_paperclip_ai
    container_name: eren_container_paperclip_ai
    environment:
      VNC_PASSWORD_FILE: /run/secrets/vnc_password
      DISPLAY: host.docker.internal:0.0
    user: "197609:197121"
    ipc: host
    volumes:
      - src:/code
    secrets:
      - vnc_password
    networks:
      - mcp_network
    command: /bin/sh -c "export DISPLAY=host.docker.internal:0.0 && /opt/conda/bin/python3 /code/main.py"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
  open_webui:
      image: ghcr.io/open-webui/open-webui:main
      container_name: open-webui
      ports:
        - "3000:8080"
      volumes:
        - ../open-webui:/app/backend/data
      restart: always
      networks:
        - mcp_network
      extra_hosts:
        - "host.docker.internal:host-gateway"
  mcp_server_container:
    image: eren_container_paperclip_ai
    container_name: eren_container_mcp_server
    environment:
      VNC_PASSWORD_FILE: /run/secrets/vnc_password
      DISPLAY: host.docker.internal:0.0
    user: "197609:197121"
    ports:
      - "16041:16041"
#      - "5900:5900"
    volumes:
      - src:/code
    secrets:
      - vnc_password
    networks:
      - mcp_network
#    command: /bin/sh -c "/opt/conda/bin/python3 /code/mcp_servers/example_server.py"
    command: /bin/sh -c "export DISPLAY=host.docker.internal:0.0 && uvx mcpo --host 0.0.0.0 --port 16041 -- /opt/conda/bin/python3 /code/mcp_servers/example_server.py"

volumes:
  src:
    driver: local
    driver_opts:
      type: none
      device: ..
      o: bind

secrets:
  vnc_password:
    file: ./secrets/vnc_password.txt
networks:
  mcp_network:
    driver: bridge
    driver_opts:
      com.docker.network.bridge.host_binding_ipv4: "127.0.0.1"